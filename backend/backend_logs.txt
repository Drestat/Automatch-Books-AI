ðŸš€ [Modal] ASGI Entrypoint waking up...
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
ðŸ—ï¸ [main.py] Running manual schema patches...
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
ðŸš€ [Modal] ASGI Entrypoint waking up...
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
ðŸ—ï¸ [main.py] Running manual schema patches...
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
    GET /api/v1/users/user_38gfoio189CGrr2AO1a9ssier7w -> 200 OK  (duration: 740.0 ms, execution: 682.6 ms)
ðŸ” [get_accounts] Starting for realm_id: 9341456245321396
âœ… [get_accounts] Connection found for user: user_38gfoio189CGrr2AO1a9ssier7w
ðŸ”„ [get_accounts] Starting sync_bank_accounts...
ðŸ”„ [sync_bank_accounts] Starting for realm_id: 9341456245321396
ðŸ“ [sync_bank_accounts] Executing query: SELECT * FROM Account WHERE AccountType IN ('Bank', 'Credit Card')
ðŸ”„ [QBOClient] Refreshing Access Token...
ðŸš€ [Modal] ASGI Entrypoint waking up...
ðŸš€ [Modal] ASGI Entrypoint waking up...
âœ… [sync_bank_accounts] Query successful, response: {'QueryResponse': {'Account': [{'Name': 'Checking', 'SubAccount': False, 'FullyQualifiedName': 'Checking', 'Active': True, 'Classification': 'Asset', 'AccountType': 'Bank', 'AccountSubType': 'Checking', 'CurrentBalance': -513.37, 'CurrentBalanceWithSubAccounts': -513.37, 'CurrencyRef': {'value': 'USD', 'name': 'United States Dollar'}, 'domain': 'QBO', 'sparse': False, 'Id': '35', 'SyncToken': '0', 'MetaData': {'CreateTime': '2025-12-28T12:08:20-08:00', 'LastUpdatedTime': '2026-02-04T14:24:13-08:00'}}, {'Name': 'Mastercard', 'SubAccount': False, 'FullyQualifiedName': 'Mastercard', 'Active': True, 'Classification': 'Liability', 'AccountType': 'Credit Card', 'AccountSubType': 'CreditCard', 'CurrentBalance': -217.73, 'CurrentBalanceWithSubAccounts': -217.73, 'CurrencyRef': {'value': 'USD', 'name': 'United States Dollar'}, 'domain': 'QBO', 'sparse': False, 'Id': '41', 'SyncToken': '1', 'MetaData': {'CreateTime': '2025-12-29T09:59:08-08:00', 'LastUpdatedTime': '2026-03-03T22:59:57-08:00'}}, {'Name': 'Savings', 'SubAccount': False, 'FullyQualifiedName': 'Savings', 'Active': True, 'Classification': 'Asset', 'AccountType': 'Bank', 'AccountSubType': 'Savings', 'CurrentBalance': 800.0, 'CurrentBalanceWithSubAccounts': 800.0, 'CurrencyRef': {'value': 'USD', 'name': 'United States Dollar'}, 'domain': 'QBO', 'sparse': False, 'Id': '36', 'SyncToken': '0', 'MetaData': {'CreateTime': '2025-12-28T12:09:00-08:00', 'LastUpdatedTime': '2026-01-01T13:00:56-08:00'}}, {'Name': 'Visa', 'SubAccount': False, 'FullyQualifiedName': 'Visa', 'Active': True, 'Classification': 'Liability', 'AccountType': 'Credit Card', 'AccountSubType': 'CreditCard', 'CurrentBalance': 0, 'CurrentBalanceWithSubAccounts': 0, 'CurrencyRef': {'value': 'USD', 'name': 'United States Dollar'}, 'domain': 'QBO', 'sparse': False, 'Id': '42', 'SyncToken': '0', 'MetaData': {'CreateTime': '2025-12-29T10:00:09-08:00', 'LastUpdatedTime': '2025-12-29T10:00:09-08:00'}}], 'startPosition': 1, 'maxResults': 4}, 'time': '2026-02-04T18:20:25.587-08:00'}
ðŸ“Š [sync_bank_accounts] Found 4 accounts from QBO
ðŸš€ [Modal] ASGI Entrypoint waking up...
ðŸ’¾ [sync_bank_accounts] Saved account: Checking (ID: 35)
ðŸ’¾ [sync_bank_accounts] Saved account: Mastercard (ID: 41)
ðŸ’¾ [sync_bank_accounts] Saved account: Savings (ID: 36)
ðŸ’¾ [sync_bank_accounts] Saved account: Visa (ID: 42)
âœ… [sync_bank_accounts] Committed 4 accounts to database
âœ… [get_accounts] sync_bank_accounts completed
ðŸ“Š [get_accounts] Found 4 accounts in database
    GET /api/v1/qbo/accounts -> 200 OK  (duration: 3.21 s, execution: 2.43 s)
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
    GET /api/v1/users/me -> 200 OK  (duration: 3.32 s, execution: 71.8 ms)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 377, in app
    content = await serialize_response(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 215, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation error:
  {'type': 'string_type', 'loc': ('response', 0, 'id'), 'msg': 'Input should be a valid string', 'input': UUID('b7927e5a-a862-43eb-b200-30b8229b676a')}

  File "/root/app/api/v1/endpoints/accounts.py", line 84, in get_tags
    GET /api/v1/accounts/tags

    GET /api/v1/accounts/tags -> 500 Internal Server Error  (duration: 3.54 s, execution: 111.0 ms)
    GET /api/v1/accounts/vendors -> 200 OK  (duration: 3.59 s, execution: 80.3 ms)
ðŸš€ [Modal] ASGI Entrypoint waking up...
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸš€ [Modal] ASGI Entrypoint waking up...
    GET /api/v1/accounts/categories -> 200 OK  (duration: 3.74 s, execution: 89.5 ms)
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
    GET /api/v1/transactions/ -> 200 OK  (duration: 874.5 ms, execution: 365.1 ms)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
    GET /api/v1/users/me -> 200 OK  (duration: 850.8 ms, execution: 58.9 ms)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
ðŸ—ï¸ [main.py] Running manual schema patches...
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸ—ï¸ [main.py] Running manual schema patches...
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
ðŸ—ï¸ [main.py] Running manual schema patches...
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
ðŸ—ï¸ [main.py] Running manual schema patches...
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
ðŸ—ï¸ [main.py] Running manual schema patches...
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
ðŸš€ [Modal] ASGI Entrypoint waking up...
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
âŒ [Modal] CRITICAL STARTUP ERROR: cannot import name 'get_current_user' from 'app.api.deps' (/root/app/api/deps.py)
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 245, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/usr/local/lib/python3.9/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
  File "/usr/local/lib/python3.9/site-packages/anyio/to_thread.py", line 63, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 2502, in run_sync_in_worker_thread
    return await future
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
  File "/root/modal_app.py", line 87, in err
    return {"error": "Startup Failed", "detail": str(e)}
NameError: free variable 'e' referenced before assignment in enclosing scope

    GET /api/v1/qbo/accounts -> 500 Internal Server Error  (duration: 357.3 ms, execution: 230.6 ms)
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 245, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/usr/local/lib/python3.9/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
  File "/usr/local/lib/python3.9/site-packages/anyio/to_thread.py", line 63, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 2502, in run_sync_in_worker_thread
    return await future
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
  File "/root/modal_app.py", line 87, in err
    return {"error": "Startup Failed", "detail": str(e)}
NameError: free variable 'e' referenced before assignment in enclosing scope

    GET /api/v1/accounts/categories -> 500 Internal Server Error  (duration: 503.2 ms, execution: 78.5 ms)
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 245, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/usr/local/lib/python3.9/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
  File "/usr/local/lib/python3.9/site-packages/anyio/to_thread.py", line 63, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 2502, in run_sync_in_worker_thread
    return await future
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
  File "/root/modal_app.py", line 87, in err
    return {"error": "Startup Failed", "detail": str(e)}
NameError: free variable 'e' referenced before assignment in enclosing scope

    GET /api/v1/accounts/vendors -> 500 Internal Server Error  (duration: 671.9 ms, execution: 78.9 ms)
    GET /api/v1/accounts/tags -> 500 Internal Server Error  (duration: 758.3 ms, execution: 92.5 ms)
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 245, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/usr/local/lib/python3.9/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
  File "/usr/local/lib/python3.9/site-packages/anyio/to_thread.py", line 63, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 2502, in run_sync_in_worker_thread
    return await future
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
  File "/root/modal_app.py", line 87, in err
    return {"error": "Startup Failed", "detail": str(e)}
NameError: free variable 'e' referenced before assignment in enclosing scope

Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 245, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/usr/local/lib/python3.9/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
  File "/usr/local/lib/python3.9/site-packages/anyio/to_thread.py", line 63, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 2502, in run_sync_in_worker_thread
    return await future
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
  File "/root/modal_app.py", line 87, in err
    return {"error": "Startup Failed", "detail": str(e)}
NameError: free variable 'e' referenced before assignment in enclosing scope

    GET /api/v1/users/me -> 500 Internal Server Error  (duration: 721.7 ms, execution: 80.9 ms)
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 245, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/usr/local/lib/python3.9/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
  File "/usr/local/lib/python3.9/site-packages/anyio/to_thread.py", line 63, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 2502, in run_sync_in_worker_thread
    return await future
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
  File "/root/modal_app.py", line 87, in err
    return {"error": "Startup Failed", "detail": str(e)}
NameError: free variable 'e' referenced before assignment in enclosing scope

    GET /api/v1/users/user_38gfoio189CGrr2AO1a9ssier7w -> 500 Internal Server Error  (duration: 773.5 ms, execution: 83.6 ms)
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 245, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/usr/local/lib/python3.9/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
  File "/usr/local/lib/python3.9/site-packages/anyio/to_thread.py", line 63, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 2502, in run_sync_in_worker_thread
    return await future
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
  File "/root/modal_app.py", line 87, in err
    return {"error": "Startup Failed", "detail": str(e)}
NameError: free variable 'e' referenced before assignment in enclosing scope

    GET /api/v1/users/me -> 500 Internal Server Error  (duration: 275.0 ms, execution: 79.1 ms)
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 245, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/usr/local/lib/python3.9/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
  File "/usr/local/lib/python3.9/site-packages/anyio/to_thread.py", line 63, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 2502, in run_sync_in_worker_thread
    return await future
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
  File "/root/modal_app.py", line 87, in err
    return {"error": "Startup Failed", "detail": str(e)}
NameError: free variable 'e' referenced before assignment in enclosing scope

    GET /api/v1/users/me -> 500 Internal Server Error  (duration: 211.7 ms, execution: 78.2 ms)
ðŸš€ [Modal] ASGI Entrypoint waking up...
ðŸš€ [Modal] ASGI Entrypoint waking up...
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
ðŸš€ [Modal] ASGI Entrypoint waking up...
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
âŒ [Modal] CRITICAL STARTUP ERROR: cannot import name 'get_current_user' from 'app.api.deps' (/root/app/api/deps.py)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
âŒ [Modal] CRITICAL STARTUP ERROR: cannot import name 'get_current_user' from 'app.api.deps' (/root/app/api/deps.py)
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
   POST /api/v1/transactions/sync -> 405 Method Not Allowed  (duration: 269.7 ms, execution: 153.7 ms)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
âŒ [Modal] CRITICAL STARTUP ERROR: cannot import name 'get_current_user' from 'app.api.deps' (/root/app/api/deps.py)
OPTIONS /api/v1/analytics/track -> 405 Method Not Allowed  (duration: 740.0 ms, execution: 503.9 ms)
OPTIONS /api/v1/qbo/disconnect -> 405 Method Not Allowed  (duration: 246.5 ms, execution: 143.3 ms)
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 245, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/usr/local/lib/python3.9/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
  File "/usr/local/lib/python3.9/site-packages/anyio/to_thread.py", line 63, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 2502, in run_sync_in_worker_thread
    return await future
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
  File "/root/modal_app.py", line 87, in err
    return {"error": "Startup Failed", "detail": str(e)}
NameError: free variable 'e' referenced before assignment in enclosing scope

    GET /api/v1/users/me -> 500 Internal Server Error  (duration: 262.3 ms, execution: 136.0 ms)
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 245, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/usr/local/lib/python3.9/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
  File "/usr/local/lib/python3.9/site-packages/anyio/to_thread.py", line 63, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 2502, in run_sync_in_worker_thread
    return await future
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
  File "/root/modal_app.py", line 87, in err
    return {"error": "Startup Failed", "detail": str(e)}
NameError: free variable 'e' referenced before assignment in enclosing scope

    GET /api/v1/users/me -> 500 Internal Server Error  (duration: 197.7 ms, execution: 79.4 ms)
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 245, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/usr/local/lib/python3.9/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
  File "/usr/local/lib/python3.9/site-packages/anyio/to_thread.py", line 63, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 2502, in run_sync_in_worker_thread
    return await future
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
  File "/root/modal_app.py", line 87, in err
    return {"error": "Startup Failed", "detail": str(e)}
NameError: free variable 'e' referenced before assignment in enclosing scope

    GET /api/v1/users/user_38gfoio189CGrr2AO1a9ssier7w -> 500 Internal Server Error  (duration: 455.2 ms, execution: 224.0 ms)
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 245, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/usr/local/lib/python3.9/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
  File "/usr/local/lib/python3.9/site-packages/anyio/to_thread.py", line 63, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 2502, in run_sync_in_worker_thread
    return await future
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
  File "/root/modal_app.py", line 87, in err
    return {"error": "Startup Failed", "detail": str(e)}
NameError: free variable 'e' referenced before assignment in enclosing scope

    GET /api/v1/users/me -> 500 Internal Server Error  (duration: 254.2 ms, execution: 135.2 ms)
OPTIONS /api/v1/analytics/track -> 405 Method Not Allowed  (duration: 271.6 ms, execution: 144.4 ms)
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 245, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/usr/local/lib/python3.9/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
  File "/usr/local/lib/python3.9/site-packages/anyio/to_thread.py", line 63, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 2502, in run_sync_in_worker_thread
    return await future
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
  File "/root/modal_app.py", line 87, in err
    return {"error": "Startup Failed", "detail": str(e)}
NameError: free variable 'e' referenced before assignment in enclosing scope

    GET /api/v1/qbo/authorize -> 500 Internal Server Error  (duration: 491.0 ms, execution: 192.1 ms)
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 245, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/usr/local/lib/python3.9/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
  File "/usr/local/lib/python3.9/site-packages/anyio/to_thread.py", line 63, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 2502, in run_sync_in_worker_thread
    return await future
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
  File "/root/modal_app.py", line 87, in err
    return {"error": "Startup Failed", "detail": str(e)}
NameError: free variable 'e' referenced before assignment in enclosing scope

    GET /api/v1/users/user_38gfoio189CGrr2AO1a9ssier7w -> 500 Internal Server Error  (duration: 211.9 ms, execution: 81.5 ms)
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 245, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/usr/local/lib/python3.9/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
  File "/usr/local/lib/python3.9/site-packages/anyio/to_thread.py", line 63, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 2502, in run_sync_in_worker_thread
    return await future
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
  File "/root/modal_app.py", line 87, in err
    return {"error": "Startup Failed", "detail": str(e)}
NameError: free variable 'e' referenced before assignment in enclosing scope

Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 245, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/usr/local/lib/python3.9/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
  File "/usr/local/lib/python3.9/site-packages/anyio/to_thread.py", line 63, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 2502, in run_sync_in_worker_thread
    return await future
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
  File "/root/modal_app.py", line 87, in err
    return {"error": "Startup Failed", "detail": str(e)}
NameError: free variable 'e' referenced before assignment in enclosing scope

    GET /api/v1/users/me -> 500 Internal Server Error  (duration: 505.5 ms, execution: 203.2 ms)
    GET /api/v1/users/me -> 500 Internal Server Error  (duration: 215.6 ms, execution: 79.9 ms)
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 245, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/usr/local/lib/python3.9/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
  File "/usr/local/lib/python3.9/site-packages/anyio/to_thread.py", line 63, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 2502, in run_sync_in_worker_thread
    return await future
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
  File "/root/modal_app.py", line 87, in err
    return {"error": "Startup Failed", "detail": str(e)}
NameError: free variable 'e' referenced before assignment in enclosing scope

    GET /api/v1/users/me -> 500 Internal Server Error  (duration: 216.6 ms, execution: 82.1 ms)
OPTIONS /api/v1/analytics/track -> 405 Method Not Allowed  (duration: 464.7 ms, execution: 200.1 ms)
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 245, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/usr/local/lib/python3.9/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
  File "/usr/local/lib/python3.9/site-packages/anyio/to_thread.py", line 63, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 2502, in run_sync_in_worker_thread
    return await future
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
  File "/root/modal_app.py", line 87, in err
    return {"error": "Startup Failed", "detail": str(e)}
NameError: free variable 'e' referenced before assignment in enclosing scope

    GET /api/v1/qbo/authorize -> 500 Internal Server Error  (duration: 208.3 ms, execution: 80.0 ms)
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 245, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/usr/local/lib/python3.9/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
  File "/usr/local/lib/python3.9/site-packages/anyio/to_thread.py", line 63, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 2502, in run_sync_in_worker_thread
    return await future
  File "/usr/local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
  File "/root/modal_app.py", line 87, in err
    return {"error": "Startup Failed", "detail": str(e)}
NameError: free variable 'e' referenced before assignment in enclosing scope

    GET /health -> 500 Internal Server Error  (duration: 195.4 ms, execution: 76.1 ms)
ðŸš€ [Modal] ASGI Entrypoint waking up...
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
ðŸ—ï¸ [main.py] Running manual schema patches...
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
    GET /health -> 200 OK  (duration: 165.1 ms, execution: 55.6 ms)
    GET /api/v1/users/user_38gfoio189CGrr2AO1a9ssier7w -> 200 OK  (duration: 359.7 ms, execution: 280.8 ms)
    GET /api/v1/users/me -> 200 OK  (duration: 665.3 ms, execution: 219.2 ms)
    GET /api/v1/users/me -> 200 OK  (duration: 337.4 ms, execution: 215.9 ms)
OPTIONS /api/v1/analytics/track -> 200 OK  (duration: 185.0 ms, execution: 96.0 ms)
ðŸš€ [Modal] ASGI Entrypoint waking up...
   POST /api/v1/analytics/track -> 200 OK  (duration: 661.7 ms, execution: 537.2 ms)
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
>>> [qbo.py] Authorize request for user: user_38gfoio189CGrr2AO1a9ssier7w
>>> [qbo.py] Using Redirect URI: https://ifvckinglovef1--qbo-sync-engine-fastapi-app.modal.run/api/v1/qbo/callback
>>> [qbo.py] Environment: sandbox
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
>>> [qbo.py] Requesting Scopes: [<Scopes.ACCOUNTING: 'com.intuit.quickbooks.accounting'>]
    GET /api/v1/qbo/authorize -> 200 OK  (duration: 492.1 ms, execution: 414.1 ms)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
ðŸ—ï¸ [main.py] Running manual schema patches...
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
    GET /api/v1/qbo/callback -> 307 Temporary Redirect  (duration: 1.16 s, execution: 1.06 s)
    GET /api/v1/accounts/vendors -> 200 OK  (duration: 323.8 ms, execution: 253.6 ms)
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 377, in app
    content = await serialize_response(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 215, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation error:
  {'type': 'string_type', 'loc': ('response', 0, 'id'), 'msg': 'Input should be a valid string', 'input': UUID('b7927e5a-a862-43eb-b200-30b8229b676a')}

  File "/root/app/api/v1/endpoints/accounts.py", line 84, in get_tags
    GET /api/v1/accounts/tags

    GET /api/v1/accounts/tags -> 500 Internal Server Error  (duration: 632.9 ms, execution: 260.2 ms)
ðŸ” [get_accounts] Starting for realm_id: 9341456245321396
âœ… [get_accounts] Connection found for user: user_38gfoio189CGrr2AO1a9ssier7w
ðŸ”„ [get_accounts] Starting sync_bank_accounts...
âš ï¸ [get_accounts] Sync failed: 'TransactionService' object has no attribute 'sync_bank_accounts'
ðŸ“‹ [get_accounts] Traceback: Traceback (most recent call last):
  File "/root/app/api/v1/endpoints/qbo.py", line 91, in get_accounts
    await service.sync_bank_accounts() # This syncs all without limit
AttributeError: 'TransactionService' object has no attribute 'sync_bank_accounts'

ðŸ“Š [get_accounts] Found 4 accounts in database
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
  File "/root/app/api/v1/endpoints/qbo.py", line 104, in get_accounts
    limit = service._get_account_limit()
AttributeError: 'TransactionService' object has no attribute '_get_account_limit'

    GET /api/v1/qbo/accounts -> 500 Internal Server Error  (duration: 1.48 s, execution: 757.9 ms)
    GET /api/v1/transactions/ -> 200 OK  (duration: 2.60 s, execution: 1.08 s)
ðŸš€ [Modal] ASGI Entrypoint waking up...
    GET /api/v1/accounts/categories -> 200 OK  (duration: 2.86 s, execution: 221.8 ms)
ðŸš€ [Modal] ASGI Entrypoint waking up...
ðŸš€ [Modal] ASGI Entrypoint waking up...
ðŸš€ [Modal] ASGI Entrypoint waking up...
   POST /api/v1/transactions/sync -> 200 OK  (duration: 3.29 s, execution: 381.8 ms)
ðŸš€ [Modal] ASGI Entrypoint waking up...
    GET /api/v1/users/me -> 200 OK  (duration: 3.30 s, execution: 214.3 ms)
    GET /api/v1/users/user_38gfoio189CGrr2AO1a9ssier7w -> 200 OK  (duration: 3.53 s, execution: 200.6 ms)
ðŸ” [get_accounts] Starting for realm_id: 9341456245321396
âœ… [get_accounts] Connection found for user: user_38gfoio189CGrr2AO1a9ssier7w
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
ðŸ”„ [get_accounts] Starting sync_bank_accounts...
âš ï¸ [get_accounts] Sync failed: 'TransactionService' object has no attribute 'sync_bank_accounts'
ðŸ“‹ [get_accounts] Traceback: Traceback (most recent call last):
  File "/root/app/api/v1/endpoints/qbo.py", line 91, in get_accounts
    await service.sync_bank_accounts() # This syncs all without limit
AttributeError: 'TransactionService' object has no attribute 'sync_bank_accounts'

ðŸ“Š [get_accounts] Found 4 accounts in database
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
  File "/root/app/api/v1/endpoints/qbo.py", line 104, in get_accounts
    limit = service._get_account_limit()
AttributeError: 'TransactionService' object has no attribute '_get_account_limit'

/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
    GET /api/v1/qbo/accounts -> 500 Internal Server Error  (duration: 3.13 s, execution: 761.3 ms)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
ðŸ” [get_accounts] Starting for realm_id: 9341456245321396
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸ—ï¸ [main.py] Running manual schema patches...
âœ… [get_accounts] Connection found for user: user_38gfoio189CGrr2AO1a9ssier7w
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸ”„ [get_accounts] Starting sync_bank_accounts...
âš ï¸ [get_accounts] Sync failed: 'TransactionService' object has no attribute 'sync_bank_accounts'
ðŸ“‹ [get_accounts] Traceback: Traceback (most recent call last):
  File "/root/app/api/v1/endpoints/qbo.py", line 91, in get_accounts
    await service.sync_bank_accounts() # This syncs all without limit
AttributeError: 'TransactionService' object has no attribute 'sync_bank_accounts'

âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
    GET /api/v1/users/me -> 200 OK  (duration: 1.74 s, execution: 94.5 ms)
ðŸ“Š [get_accounts] Found 4 accounts in database
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
  File "/root/app/api/v1/endpoints/qbo.py", line 104, in get_accounts
    limit = service._get_account_limit()
AttributeError: 'TransactionService' object has no attribute '_get_account_limit'

    GET /api/v1/qbo/accounts -> 500 Internal Server Error  (duration: 2.05 s, execution: 735.6 ms)
ðŸ”„ [Modal] Starting background sync for 9341456245321396
ðŸ—ï¸ [main.py] Running manual schema patches...
ðŸ” [get_accounts] Starting for realm_id: 9341456245321396
ðŸ—ï¸ [main.py] Running manual schema patches...
âœ… [get_accounts] Connection found for user: user_38gfoio189CGrr2AO1a9ssier7w
    GET /api/v1/transactions/ -> 200 OK  (duration: 350.2 ms, execution: 293.0 ms)
ðŸ” [get_accounts] Starting for realm_id: 9341456245321396
âœ… [get_accounts] Connection found for user: user_38gfoio189CGrr2AO1a9ssier7w
ðŸ”„ [get_accounts] Starting sync_bank_accounts...
âš ï¸ [get_accounts] Sync failed: 'TransactionService' object has no attribute 'sync_bank_accounts'
ðŸ“‹ [get_accounts] Traceback: Traceback (most recent call last):
  File "/root/app/api/v1/endpoints/qbo.py", line 91, in get_accounts
    await service.sync_bank_accounts() # This syncs all without limit
AttributeError: 'TransactionService' object has no attribute 'sync_bank_accounts'

ðŸ”„ [get_accounts] Starting sync_bank_accounts...
âš ï¸ [get_accounts] Sync failed: 'TransactionService' object has no attribute 'sync_bank_accounts'
ðŸ“‹ [get_accounts] Traceback: Traceback (most recent call last):
  File "/root/app/api/v1/endpoints/qbo.py", line 91, in get_accounts
    await service.sync_bank_accounts() # This syncs all without limit
AttributeError: 'TransactionService' object has no attribute 'sync_bank_accounts'

âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
âœ… [main.py] Schema repair complete.
ðŸ“Š [get_accounts] Found 4 accounts in database
ðŸ“Š [get_accounts] Found 4 accounts in database
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
  File "/root/app/api/v1/endpoints/qbo.py", line 104, in get_accounts
    limit = service._get_account_limit()
AttributeError: 'TransactionService' object has no attribute '_get_account_limit'

âœ… [main.py] Database initialized.
    GET /api/v1/qbo/accounts -> 500 Internal Server Error  (duration: 1.19 s, execution: 809.9 ms)
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
  File "/root/app/api/v1/endpoints/qbo.py", line 104, in get_accounts
    limit = service._get_account_limit()
AttributeError: 'TransactionService' object has no attribute '_get_account_limit'

    GET /api/v1/qbo/accounts -> 500 Internal Server Error  (duration: 1.22 s, execution: 1.15 s)
ðŸ—ï¸ [main.py] Running manual schema patches...
ðŸ” [get_accounts] Starting for realm_id: 9341456245321396
âœ… [get_accounts] Connection found for user: user_38gfoio189CGrr2AO1a9ssier7w
ðŸš€ [SyncService] Starting sync for realm: 9341456245321396
ðŸ”„ [SyncService] Syncing bank accounts...
ðŸ”„ [get_accounts] Starting sync_bank_accounts...
âš ï¸ [get_accounts] Sync failed: 'TransactionService' object has no attribute 'sync_bank_accounts'
ðŸ“‹ [get_accounts] Traceback: Traceback (most recent call last):
  File "/root/app/api/v1/endpoints/qbo.py", line 91, in get_accounts
    await service.sync_bank_accounts() # This syncs all without limit
AttributeError: 'TransactionService' object has no attribute 'sync_bank_accounts'

ðŸ—ï¸ [main.py] Running manual schema patches...
âŒ [main.py] Database error during startup: (psycopg2.errors.DeadlockDetected) deadlock detected
DETAIL:  Process 1674 waits for AccessExclusiveLock on relation 57344 of database 16391; blocked by process 532.
Process 532 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 1671.
Process 1671 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 1674.
HINT:  See server log for query details.

[SQL: ALTER TABLE bank_accounts ADD COLUMN IF NOT EXISTS is_active BOOLEAN DEFAULT FALSE;]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
ðŸ“Š [get_accounts] Found 4 accounts in database
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
  File "/root/app/api/v1/endpoints/qbo.py", line 104, in get_accounts
    limit = service._get_account_limit()
AttributeError: 'TransactionService' object has no attribute '_get_account_limit'

Traceback (most recent call last):
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.DeadlockDetected: deadlock detected
DETAIL:  Process 1674 waits for AccessExclusiveLock on relation 57344 of database 16391; blocked by process 532.
Process 532 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 1671.
Process 1671 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 1674.
HINT:  See server log for query details.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/app/main.py", line 32, in lifespan
    conn.execute(text("ALTER TABLE bank_accounts ADD COLUMN IF NOT EXISTS is_active BOOLEAN DEFAULT FALSE;"))
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.errors.DeadlockDetected) deadlock detected
DETAIL:  Process 1674 waits for AccessExclusiveLock on relation 57344 of database 16391; blocked by process 532.
Process 532 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 1671.
Process 1671 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 1674.
HINT:  See server log for query details.

[SQL: ALTER TABLE bank_accounts ADD COLUMN IF NOT EXISTS is_active BOOLEAN DEFAULT FALSE;]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

âŒ [main.py] Database error during startup: (psycopg2.errors.DeadlockDetected) deadlock detected
DETAIL:  Process 532 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 1671.
Process 1671 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 532.
HINT:  See server log for query details.

[SQL: ALTER TABLE qbo_connections ADD COLUMN IF NOT EXISTS updated_at TIMESTAMP WITH TIME ZONE DEFAULT now();]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
    GET /api/v1/qbo/accounts -> 500 Internal Server Error  (duration: 2.00 s, execution: 1.91 s)
Traceback (most recent call last):
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.DeadlockDetected: deadlock detected
DETAIL:  Process 532 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 1671.
Process 1671 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 532.
HINT:  See server log for query details.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/app/main.py", line 47, in lifespan
    conn.execute(text("ALTER TABLE qbo_connections ADD COLUMN IF NOT EXISTS updated_at TIMESTAMP WITH TIME ZONE DEFAULT now();"))
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.errors.DeadlockDetected) deadlock detected
DETAIL:  Process 532 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 1671.
Process 1671 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 532.
HINT:  See server log for query details.

[SQL: ALTER TABLE qbo_connections ADD COLUMN IF NOT EXISTS updated_at TIMESTAMP WITH TIME ZONE DEFAULT now();]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

ðŸ” [get_accounts] Starting for realm_id: 9341456245321396
âœ… [get_accounts] Connection found for user: user_38gfoio189CGrr2AO1a9ssier7w
ðŸ”„ [get_accounts] Starting sync_bank_accounts...
âš ï¸ [get_accounts] Sync failed: 'TransactionService' object has no attribute 'sync_bank_accounts'
ðŸ“‹ [get_accounts] Traceback: Traceback (most recent call last):
  File "/root/app/api/v1/endpoints/qbo.py", line 91, in get_accounts
    await service.sync_bank_accounts() # This syncs all without limit
AttributeError: 'TransactionService' object has no attribute 'sync_bank_accounts'

ðŸ“Š [get_accounts] Found 4 accounts in database
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
  File "/root/app/api/v1/endpoints/qbo.py", line 104, in get_accounts
    limit = service._get_account_limit()
AttributeError: 'TransactionService' object has no attribute '_get_account_limit'

    GET /api/v1/qbo/accounts -> 500 Internal Server Error  (duration: 869.5 ms, execution: 796.8 ms)
âŒ [QBOClient] HTTP Error: {"Fault":{"Error":[{"Message":"Invalid query","Detail":"QueryValidationError: invalid context declaration: CreditCardCredit","code":"4001"}],"type":"ValidationFault"},"time":"2026-02-04T18:27:29.218-08:00"}
âš ï¸ Error syncing CreditCardCredit: Client error '400 Bad Request' for url 'https://sandbox-quickbooks.api.intuit.com/v3/company/9341456245321396/query?query=SELECT+%2A+FROM+CreditCardCredit+STARTPOSITION+1+MAXRESULTS+1000'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
âœ… [SyncService] Completed sync for realm: 9341456245321396
âœ… Sync complete
ðŸ§  Triggering AI Analysis...
ðŸ§  [Modal] Starting AI Analysis for 9341456245321396
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸ” [AnalysisService] Starting analysis for realm 9341456245321396...
ðŸ’° Tokens deducted: 35 for 'AI Analysis'. New Balance: 0
âŒ Batch AI Error: 429 Resource exhausted. Please try again later. Please refer to https://cloud.google.com/vertex-ai/generative-ai/docs/error-code-429 for more details.
âœ… Analysis complete. Processed 0 transactions.
ðŸš€ [Modal] ASGI Entrypoint waking up...
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
    GET /health -> 200 OK  (duration: 178.8 ms, execution: 78.0 ms)
ðŸ—ï¸ [main.py] Running manual schema patches...
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
ðŸš€ [Modal] ASGI Entrypoint waking up...
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
ðŸ—ï¸ [main.py] Running manual schema patches...
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
OPTIONS /api/v1/qbo/disconnect -> 200 OK  (duration: 215.6 ms, execution: 151.3 ms)
ðŸ”Œ [disconnect] Called with realm_id: 9341456245321396
âœ… [disconnect] Found connection for user: user_38gfoio189CGrr2AO1a9ssier7w
ðŸ”Œ [QBOClient] Revoking token...
ðŸ—‘ï¸ [disconnect] Deleted: 38 transactions, 4 accounts, 27 logs
âœ… [disconnect] Successfully disconnected realm_id: 9341456245321396
 DELETE /api/v1/qbo/disconnect -> 200 OK  (duration: 1.57 s, execution: 1.43 s)
    GET /api/v1/users/me -> 200 OK  (duration: 171.4 ms, execution: 120.0 ms)
    GET /api/v1/users/user_38gfoio189CGrr2AO1a9ssier7w -> 200 OK  (duration: 275.6 ms, execution: 67.9 ms)
    GET /api/v1/users/me -> 200 OK  (duration: 157.9 ms, execution: 57.4 ms)
ðŸš€ [Modal] ASGI Entrypoint waking up...
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
ðŸ—ï¸ [main.py] Running manual schema patches...
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
    GET /api/v1/users/me -> 200 OK  (duration: 153.4 ms, execution: 87.7 ms)
    GET /api/v1/users/me -> 200 OK  (duration: 142.5 ms, execution: 77.8 ms)
    GET /api/v1/users/user_38gfoio189CGrr2AO1a9ssier7w -> 200 OK  (duration: 360.5 ms, execution: 269.3 ms)
OPTIONS /api/v1/analytics/track -> 200 OK  (duration: 82.6 ms, execution: 18.6 ms)
   POST /api/v1/analytics/track -> 200 OK  (duration: 508.1 ms, execution: 431.7 ms)
>>> [qbo.py] Authorize request for user: user_38gfoio189CGrr2AO1a9ssier7w
>>> [qbo.py] Using Redirect URI: https://ifvckinglovef1--qbo-sync-engine-fastapi-app.modal.run/api/v1/qbo/callback
>>> [qbo.py] Environment: sandbox
>>> [qbo.py] Requesting Scopes: [<Scopes.ACCOUNTING: 'com.intuit.quickbooks.accounting'>]
    GET /api/v1/qbo/authorize -> 200 OK  (duration: 527.9 ms, execution: 453.4 ms)
    GET /api/v1/qbo/callback -> 307 Temporary Redirect  (duration: 1.28 s, execution: 1.18 s)
   POST /api/v1/transactions/sync -> 200 OK  (duration: 205.3 ms, execution: 132.0 ms)
ðŸ” [get_accounts] Starting for realm_id: 9341456245321396
âœ… [get_accounts] Connection found for user: user_38gfoio189CGrr2AO1a9ssier7w
    GET /api/v1/transactions/ -> 200 OK  (duration: 308.9 ms, execution: 216.9 ms)
    GET /api/v1/accounts/tags -> 200 OK  (duration: 554.3 ms, execution: 210.7 ms)
ðŸ”„ [get_accounts] Starting sync_bank_accounts...
    GET /api/v1/accounts/categories -> 200 OK  (duration: 901.5 ms, execution: 281.8 ms)
ðŸ”„ [SyncService] Syncing bank accounts...
    GET /api/v1/accounts/vendors -> 200 OK  (duration: 1.18 s, execution: 213.1 ms)
    GET /api/v1/users/me -> 200 OK  (duration: 1.17 s, execution: 220.5 ms)
    GET /api/v1/users/user_38gfoio189CGrr2AO1a9ssier7w -> 200 OK  (duration: 1.46 s, execution: 236.0 ms)
    GET /api/v1/users/me -> 200 OK  (duration: 573.7 ms, execution: 227.3 ms)
ðŸ”„ [Modal] Starting background sync for 9341456245321396
    GET /api/v1/transactions/ -> 200 OK  (duration: 342.0 ms, execution: 247.4 ms)
ðŸš€ [Modal] ASGI Entrypoint waking up...
ðŸš€ [Modal] ASGI Entrypoint waking up...
ðŸš€ [Modal] ASGI Entrypoint waking up...
ðŸš€ [SyncService] Starting sync for realm: 9341456245321396
ðŸ”„ [SyncService] Syncing bank accounts...
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
âœ… [get_accounts] sync_bank_accounts completed
ðŸ“Š [get_accounts] Found 4 accounts in database
    GET /api/v1/qbo/accounts -> 200 OK  (duration: 5.89 s, execution: 5.66 s)
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
âŒ [SyncService] Bank account sync failed: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "bank_accounts_pkey"
DETAIL:  Key (id)=(35) already exists.

[SQL: INSERT INTO bank_accounts (id, realm_id, name, nickname, currency, balance, is_active, is_connected) VALUES (%(id__0)s, %(realm_id__0)s, %(name__0)s, %(nickname__0)s, %(currency__0)s, %(balance__0)s, %(is_active__0)s, %(is_connected__0)s), (%(id__1)s, %(realm_id__1)s, %(name__1)s, %(nickname__1)s, %(currency__1)s, %(balance__1)s, %(is_active__1)s, %(is_connected__1)s) RETURNING bank_accounts.updated_at, bank_accounts.id]
[parameters: {'nickname__0': None, 'currency__0': 'USD', 'is_connected__0': True, 'id__0': '35', 'is_active__0': False, 'balance__0': -513.37, 'realm_id__0': '9341456245321396', 'name__0': 'Checking', 'nickname__1': None, 'currency__1': 'USD', 'is_connected__1': True, 'id__1': '41', 'is_active__1': False, 'balance__1': -217.73, 'realm_id__1': '9341456245321396', 'name__1': 'Mastercard'}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
âŒ Sync failed: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "bank_accounts_pkey"
DETAIL:  Key (id)=(35) already exists.

[SQL: INSERT INTO bank_accounts (id, realm_id, name, nickname, currency, balance, is_active, is_connected) VALUES (%(id__0)s, %(realm_id__0)s, %(name__0)s, %(nickname__0)s, %(currency__0)s, %(balance__0)s, %(is_active__0)s, %(is_connected__0)s), (%(id__1)s, %(realm_id__1)s, %(name__1)s, %(nickname__1)s, %(currency__1)s, %(balance__1)s, %(is_active__1)s, %(is_connected__1)s) RETURNING bank_accounts.updated_at, bank_accounts.id]
[parameters: {'nickname__0': None, 'currency__0': 'USD', 'is_connected__0': True, 'id__0': '35', 'is_active__0': False, 'balance__0': -513.37, 'realm_id__0': '9341456245321396', 'name__0': 'Checking', 'nickname__1': None, 'currency__1': 'USD', 'is_connected__1': True, 'id__1': '41', 'is_active__1': False, 'balance__1': -217.73, 'realm_id__1': '9341456245321396', 'name__1': 'Mastercard'}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
ðŸ—ï¸ [main.py] Running manual schema patches...
    GET /api/v1/transactions/ -> 200 OK  (duration: 142.6 ms, execution: 78.6 ms)
ðŸ” [get_accounts] Starting for realm_id: 9341456245321396
âœ… [get_accounts] Connection found for user: user_38gfoio189CGrr2AO1a9ssier7w
ðŸ”„ [get_accounts] Starting sync_bank_accounts...
ðŸ—ï¸ [main.py] Running manual schema patches...
ðŸ”„ [SyncService] Syncing bank accounts...
âŒ [main.py] Database error during startup: (psycopg2.errors.DeadlockDetected) deadlock detected
DETAIL:  Process 4336 waits for AccessExclusiveLock on relation 57344 of database 16391; blocked by process 4215.
Process 4215 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 532.
Process 532 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 4336.
HINT:  See server log for query details.

[SQL: ALTER TABLE bank_accounts ADD COLUMN IF NOT EXISTS is_active BOOLEAN DEFAULT FALSE;]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.DeadlockDetected: deadlock detected
DETAIL:  Process 4336 waits for AccessExclusiveLock on relation 57344 of database 16391; blocked by process 4215.
Process 4215 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 532.
Process 532 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 4336.
HINT:  See server log for query details.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/app/main.py", line 32, in lifespan
    conn.execute(text("ALTER TABLE bank_accounts ADD COLUMN IF NOT EXISTS is_active BOOLEAN DEFAULT FALSE;"))
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.errors.DeadlockDetected) deadlock detected
DETAIL:  Process 4336 waits for AccessExclusiveLock on relation 57344 of database 16391; blocked by process 4215.
Process 4215 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 532.
Process 532 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 4336.
HINT:  See server log for query details.

[SQL: ALTER TABLE bank_accounts ADD COLUMN IF NOT EXISTS is_active BOOLEAN DEFAULT FALSE;]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

ðŸ—ï¸ [main.py] Running manual schema patches...
âŒ [SyncService] Bank account sync failed: (psycopg2.errors.DeadlockDetected) deadlock detected
LINE 1: UPDATE bank_accounts SET is_connected=false, updated_at=now(...
               ^
DETAIL:  Process 532 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 4215.
Process 4215 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 532.
HINT:  See server log for query details.

[SQL: UPDATE bank_accounts SET is_connected=%(is_connected)s, updated_at=now() WHERE bank_accounts.realm_id = %(realm_id_1)s]
[parameters: {'is_connected': False, 'realm_id_1': '9341456245321396'}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
âš ï¸ [get_accounts] Sync failed: (psycopg2.errors.DeadlockDetected) deadlock detected
LINE 1: UPDATE bank_accounts SET is_connected=false, updated_at=now(...
               ^
DETAIL:  Process 532 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 4215.
Process 4215 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 532.
HINT:  See server log for query details.

[SQL: UPDATE bank_accounts SET is_connected=%(is_connected)s, updated_at=now() WHERE bank_accounts.realm_id = %(realm_id_1)s]
[parameters: {'is_connected': False, 'realm_id_1': '9341456245321396'}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
âœ… [main.py] Schema repair complete.
ðŸ“‹ [get_accounts] Traceback: Traceback (most recent call last):
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.DeadlockDetected: deadlock detected
LINE 1: UPDATE bank_accounts SET is_connected=false, updated_at=now(...
               ^
DETAIL:  Process 532 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 4215.
Process 4215 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 532.
HINT:  See server log for query details.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/app/api/v1/endpoints/qbo.py", line 91, in get_accounts
    await service.sync_bank_accounts() # This syncs all without limit
  File "/root/app/services/transaction_service.py", line 19, in sync_bank_accounts
    await syncer.sync_bank_accounts()
  File "/root/app/services/sync_service.py", line 43, in sync_bank_accounts
    self.db.query(BankAccount).filter(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/orm/query.py", line 3304, in update
    self.session.execute(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/orm/bulk_persistence.py", line 1660, in orm_execute_statement
    return super().orm_execute_statement(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.errors.DeadlockDetected) deadlock detected
LINE 1: UPDATE bank_accounts SET is_connected=false, updated_at=now(...
               ^
DETAIL:  Process 532 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 4215.
Process 4215 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 532.
HINT:  See server log for query details.

[SQL: UPDATE bank_accounts SET is_connected=%(is_connected)s, updated_at=now() WHERE bank_accounts.realm_id = %(realm_id_1)s]
[parameters: {'is_connected': False, 'realm_id_1': '9341456245321396'}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

âœ… [main.py] Database initialized.
âœ… [main.py] Schema repair complete.
ðŸ“Š [get_accounts] Found 4 accounts in database
âœ… [main.py] Database initialized.
    GET /api/v1/qbo/accounts -> 200 OK  (duration: 3.50 s, execution: 3.44 s)
ðŸ” [get_accounts] Starting for realm_id: 9341456245321396
âœ… [get_accounts] Connection found for user: user_38gfoio189CGrr2AO1a9ssier7w
    GET /api/v1/transactions/ -> 200 OK  (duration: 360.3 ms, execution: 270.9 ms)
ðŸ”„ [get_accounts] Starting sync_bank_accounts...
ðŸ”„ [SyncService] Syncing bank accounts...
âœ… [get_accounts] sync_bank_accounts completed
ðŸ“Š [get_accounts] Found 4 accounts in database
    GET /api/v1/qbo/accounts -> 200 OK  (duration: 1.55 s, execution: 1.48 s)
ðŸ” [get_accounts] Starting for realm_id: 9341456245321396
âœ… [get_accounts] Connection found for user: user_38gfoio189CGrr2AO1a9ssier7w
ðŸ”„ [get_accounts] Starting sync_bank_accounts...
ðŸ”„ [SyncService] Syncing bank accounts...
âœ… [get_accounts] sync_bank_accounts completed
ðŸ“Š [get_accounts] Found 4 accounts in database
    GET /api/v1/qbo/accounts -> 200 OK  (duration: 2.24 s, execution: 2.17 s)
    GET /api/v1/transactions/ -> 200 OK  (duration: 856.5 ms, execution: 717.9 ms)
OPTIONS /api/v1/qbo/accounts/preview -> 200 OK  (duration: 102.3 ms, execution: 32.9 ms)
   POST /api/v1/qbo/accounts/preview -> 422 Unprocessable Entity  (duration: 160.4 ms, execution: 70.8 ms)
   POST /api/v1/qbo/accounts/preview -> 422 Unprocessable Entity  (duration: 136.5 ms, execution: 63.5 ms)
ðŸ” [get_accounts] Starting for realm_id: 9341456245321396
âœ… [get_accounts] Connection found for user: user_38gfoio189CGrr2AO1a9ssier7w
    GET /api/v1/accounts/categories -> 200 OK  (duration: 272.3 ms, execution: 206.0 ms)
ðŸ”„ [get_accounts] Starting sync_bank_accounts...
    GET /api/v1/accounts/vendors -> 200 OK  (duration: 521.1 ms, execution: 194.6 ms)
    GET /api/v1/accounts/tags -> 200 OK  (duration: 761.3 ms, execution: 201.1 ms)
ðŸ”„ [SyncService] Syncing bank accounts...
    GET /api/v1/users/me -> 200 OK  (duration: 810.0 ms, execution: 244.0 ms)
    GET /api/v1/users/user_38gfoio189CGrr2AO1a9ssier7w -> 200 OK  (duration: 1.07 s, execution: 213.2 ms)
    GET /api/v1/users/me -> 200 OK  (duration: 529.0 ms, execution: 204.8 ms)
âœ… [get_accounts] sync_bank_accounts completed
ðŸ“Š [get_accounts] Found 4 accounts in database
    GET /api/v1/qbo/accounts -> 200 OK  (duration: 1.68 s, execution: 1.62 s)
    GET /api/v1/transactions/ -> 200 OK  (duration: 327.9 ms, execution: 247.0 ms)
ðŸš€ [Modal] ASGI Entrypoint waking up...
ðŸš€ [Modal] ASGI Entrypoint waking up...
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
ðŸ—ï¸ [main.py] Running manual schema patches...
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
ðŸ—ï¸ [main.py] Running manual schema patches...
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
ðŸ” [get_accounts] Starting for realm_id: 9341456245321396
âœ… [get_accounts] Connection found for user: user_38gfoio189CGrr2AO1a9ssier7w
ðŸ”„ [get_accounts] Starting sync_bank_accounts...
ðŸ”„ [SyncService] Syncing bank accounts...
âœ… [get_accounts] sync_bank_accounts completed
ðŸ“Š [get_accounts] Found 4 accounts in database
    GET /api/v1/qbo/accounts -> 200 OK  (duration: 1.53 s, execution: 1.45 s)
   POST /api/v1/qbo/accounts/preview -> 422 Unprocessable Entity  (duration: 110.4 ms, execution: 39.0 ms)
   POST /api/v1/qbo/accounts/preview -> 422 Unprocessable Entity  (duration: 138.7 ms, execution: 63.2 ms)
ðŸš€ [Modal] ASGI Entrypoint waking up...
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
    GET /health -> 200 OK  (duration: 222.3 ms, execution: 150.9 ms)
ðŸ—ï¸ [main.py] Running manual schema patches...
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
ðŸ”Œ [disconnect] Called with realm_id: 9341456245321396
âœ… [disconnect] Found connection for user: user_38gfoio189CGrr2AO1a9ssier7w
ðŸ”Œ [QBOClient] Revoking token...
ðŸ—‘ï¸ [disconnect] Deleted: 0 transactions, 4 accounts, 5 logs
âœ… [disconnect] Successfully disconnected realm_id: 9341456245321396
 DELETE /api/v1/qbo/disconnect -> 200 OK  (duration: 3.40 s, execution: 3.26 s)
    GET /api/v1/users/user_38gfoio189CGrr2AO1a9ssier7w -> 200 OK  (duration: 1.13 s, execution: 948.1 ms)
    GET /api/v1/users/me -> 200 OK  (duration: 2.17 s, execution: 895.5 ms)
ðŸš€ [Modal] ASGI Entrypoint waking up...
    GET /api/v1/users/me -> 200 OK  (duration: 1.23 s, execution: 1.01 s)
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
ðŸ—ï¸ [main.py] Running manual schema patches...
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
   POST /api/v1/analytics/track -> 200 OK  (duration: 1.97 s, execution: 1.83 s)
>>> [qbo.py] Authorize request for user: user_38gfoio189CGrr2AO1a9ssier7w
>>> [qbo.py] Using Redirect URI: https://ifvckinglovef1--qbo-sync-engine-fastapi-app.modal.run/api/v1/qbo/callback
>>> [qbo.py] Environment: sandbox
>>> [qbo.py] Requesting Scopes: [<Scopes.ACCOUNTING: 'com.intuit.quickbooks.accounting'>]
    GET /api/v1/qbo/authorize -> 200 OK  (duration: 935.2 ms, execution: 734.1 ms)
ðŸš€ [Modal] ASGI Entrypoint waking up...
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
    GET /api/v1/qbo/callback -> 307 Temporary Redirect  (duration: 2.75 s, execution: 2.58 s)
ðŸ—ï¸ [main.py] Running manual schema patches...
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
    GET /api/v1/accounts/vendors -> 200 OK  (duration: 509.0 ms, execution: 309.3 ms)
    GET /api/v1/accounts/tags -> 200 OK  (duration: 805.2 ms, execution: 213.0 ms)
ðŸ” [get_accounts] Starting for realm_id: 9341456245321396
âœ… [get_accounts] Connection found for user: user_38gfoio189CGrr2AO1a9ssier7w
   POST /api/v1/transactions/sync -> 200 OK  (duration: 1.23 s, execution: 387.7 ms)
    GET /api/v1/accounts/categories -> 200 OK  (duration: 1.59 s, execution: 287.6 ms)
ðŸ”„ [get_accounts] Starting sync_bank_accounts...
    GET /api/v1/transactions/ -> 200 OK  (duration: 1.88 s, execution: 205.4 ms)
    GET /api/v1/users/me -> 200 OK  (duration: 1.81 s, execution: 244.3 ms)
ðŸ”„ [SyncService] Syncing bank accounts...
    GET /api/v1/users/user_38gfoio189CGrr2AO1a9ssier7w -> 200 OK  (duration: 2.12 s, execution: 266.2 ms)
ðŸš€ [Modal] ASGI Entrypoint waking up...
    GET /api/v1/users/me -> 200 OK  (duration: 599.6 ms, execution: 228.7 ms)
ðŸš€ [Modal] ASGI Entrypoint waking up...
ðŸš€ [Modal] ASGI Entrypoint waking up...
    GET /api/v1/transactions/ -> 200 OK  (duration: 317.8 ms, execution: 199.8 ms)
ðŸš€ [Modal] ASGI Entrypoint waking up...
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
ðŸš€ [Modal] ASGI Entrypoint waking up...
âœ… [get_accounts] sync_bank_accounts completed
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸš€ [Modal] ASGI Entrypoint waking up...
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
ðŸ”„ [Modal] Starting background sync for 9341456245321396
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
ðŸ—ï¸ [main.py] Running manual schema patches...
ðŸ—ï¸ [main.py] Running manual schema patches...
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
ðŸ“Š [get_accounts] Found 4 accounts in database
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
    GET /api/v1/qbo/accounts -> 200 OK  (duration: 6.30 s, execution: 6.15 s)
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
ðŸ” [get_accounts] Starting for realm_id: 9341456245321396
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
âœ… [get_accounts] Connection found for user: user_38gfoio189CGrr2AO1a9ssier7w
    GET /api/v1/transactions/ -> 200 OK  (duration: 415.9 ms, execution: 318.2 ms)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
ðŸ”„ [get_accounts] Starting sync_bank_accounts...
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸ”„ [SyncService] Syncing bank accounts...
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
ðŸ—ï¸ [main.py] Running manual schema patches...
ðŸ—ï¸ [main.py] Running manual schema patches...
âŒ [main.py] Database error during startup: (psycopg2.errors.DeadlockDetected) deadlock detected
DETAIL:  Process 5555 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 532.
Process 532 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 5555.
HINT:  See server log for query details.

[SQL: ALTER TABLE qbo_connections ADD COLUMN IF NOT EXISTS updated_at TIMESTAMP WITH TIME ZONE DEFAULT now();]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
ðŸš€ [SyncService] Starting sync for realm: 9341456245321396
ðŸ”„ [SyncService] Syncing bank accounts...
Traceback (most recent call last):
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.DeadlockDetected: deadlock detected
DETAIL:  Process 5555 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 532.
Process 532 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 5555.
HINT:  See server log for query details.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/app/main.py", line 47, in lifespan
    conn.execute(text("ALTER TABLE qbo_connections ADD COLUMN IF NOT EXISTS updated_at TIMESTAMP WITH TIME ZONE DEFAULT now();"))
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.errors.DeadlockDetected) deadlock detected
DETAIL:  Process 5555 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 532.
Process 532 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 5555.
HINT:  See server log for query details.

[SQL: ALTER TABLE qbo_connections ADD COLUMN IF NOT EXISTS updated_at TIMESTAMP WITH TIME ZONE DEFAULT now();]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

ðŸ—ï¸ [main.py] Running manual schema patches...
âœ… [get_accounts] sync_bank_accounts completed
âŒ [main.py] Database error during startup: (psycopg2.errors.DeadlockDetected) deadlock detected
DETAIL:  Process 5555 waits for AccessExclusiveLock on relation 57344 of database 16391; blocked by process 4336.
Process 4336 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 4215.
Process 4215 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 5555.
HINT:  See server log for query details.

[SQL: ALTER TABLE bank_accounts ADD COLUMN IF NOT EXISTS is_active BOOLEAN DEFAULT FALSE;]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.DeadlockDetected: deadlock detected
DETAIL:  Process 5555 waits for AccessExclusiveLock on relation 57344 of database 16391; blocked by process 4336.
Process 4336 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 4215.
Process 4215 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 5555.
HINT:  See server log for query details.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/app/main.py", line 32, in lifespan
    conn.execute(text("ALTER TABLE bank_accounts ADD COLUMN IF NOT EXISTS is_active BOOLEAN DEFAULT FALSE;"))
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.errors.DeadlockDetected) deadlock detected
DETAIL:  Process 5555 waits for AccessExclusiveLock on relation 57344 of database 16391; blocked by process 4336.
Process 4336 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 4215.
Process 4215 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 5555.
HINT:  See server log for query details.

[SQL: ALTER TABLE bank_accounts ADD COLUMN IF NOT EXISTS is_active BOOLEAN DEFAULT FALSE;]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

âœ… [main.py] Schema repair complete.
ðŸ“Š [get_accounts] Found 4 accounts in database
âœ… [main.py] Database initialized.
    GET /api/v1/qbo/accounts -> 200 OK  (duration: 4.08 s, execution: 4.00 s)
ðŸ” [get_accounts] Starting for realm_id: 9341456245321396
âœ… [get_accounts] Connection found for user: user_38gfoio189CGrr2AO1a9ssier7w
    GET /api/v1/transactions/ -> 200 OK  (duration: 533.8 ms, execution: 281.5 ms)
ðŸ”„ [get_accounts] Starting sync_bank_accounts...
ðŸ”„ [SyncService] Syncing bank accounts...
âŒ [SyncService] Bank account sync failed: (psycopg2.errors.DeadlockDetected) deadlock detected
LINE 1: UPDATE bank_accounts SET is_connected=false, updated_at=now(...
               ^
DETAIL:  Process 4215 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 4336.
Process 4336 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 4215.
HINT:  See server log for query details.

[SQL: UPDATE bank_accounts SET is_connected=%(is_connected)s, updated_at=now() WHERE bank_accounts.realm_id = %(realm_id_1)s]
[parameters: {'is_connected': False, 'realm_id_1': '9341456245321396'}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
âŒ Sync failed: (psycopg2.errors.DeadlockDetected) deadlock detected
LINE 1: UPDATE bank_accounts SET is_connected=false, updated_at=now(...
               ^
DETAIL:  Process 4215 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 4336.
Process 4336 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 4215.
HINT:  See server log for query details.

[SQL: UPDATE bank_accounts SET is_connected=%(is_connected)s, updated_at=now() WHERE bank_accounts.realm_id = %(realm_id_1)s]
[parameters: {'is_connected': False, 'realm_id_1': '9341456245321396'}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
âœ… [get_accounts] sync_bank_accounts completed
ðŸ“Š [get_accounts] Found 4 accounts in database
    GET /api/v1/qbo/accounts -> 200 OK  (duration: 2.42 s, execution: 2.32 s)
ðŸ—ï¸ [main.py] Running manual schema patches...
ðŸ” [get_accounts] Starting for realm_id: 9341456245321396
âœ… [get_accounts] Connection found for user: user_38gfoio189CGrr2AO1a9ssier7w
ðŸ”„ [get_accounts] Starting sync_bank_accounts...
ðŸ”„ [SyncService] Syncing bank accounts...
âŒ [main.py] Database error during startup: (psycopg2.errors.DeadlockDetected) deadlock detected
DETAIL:  Process 4336 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 532.
Process 532 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 4336.
HINT:  See server log for query details.

[SQL: ALTER TABLE qbo_connections ADD COLUMN IF NOT EXISTS updated_at TIMESTAMP WITH TIME ZONE DEFAULT now();]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.DeadlockDetected: deadlock detected
DETAIL:  Process 4336 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 532.
Process 532 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 4336.
HINT:  See server log for query details.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/app/main.py", line 47, in lifespan
    conn.execute(text("ALTER TABLE qbo_connections ADD COLUMN IF NOT EXISTS updated_at TIMESTAMP WITH TIME ZONE DEFAULT now();"))
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.errors.DeadlockDetected) deadlock detected
DETAIL:  Process 4336 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 532.
Process 532 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 4336.
HINT:  See server log for query details.

[SQL: ALTER TABLE qbo_connections ADD COLUMN IF NOT EXISTS updated_at TIMESTAMP WITH TIME ZONE DEFAULT now();]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

âœ… [get_accounts] sync_bank_accounts completed
ðŸ“Š [get_accounts] Found 4 accounts in database
    GET /api/v1/qbo/accounts -> 200 OK  (duration: 7.19 s, execution: 7.00 s)
    GET /api/v1/transactions/ -> 200 OK  (duration: 1.93 s, execution: 1.67 s)
âŒ [QBOClient] HTTP Error: {"Fault":{"Error":[{"Message":"Invalid query","Detail":"QueryValidationError: invalid context declaration: CreditCardCredit","code":"4001"}],"type":"ValidationFault"},"time":"2026-02-04T18:51:22.754-08:00"}
   POST /api/v1/qbo/accounts/preview -> 200 OK  (duration: 3.22 s, execution: 3.11 s)
OPTIONS /api/v1/qbo/accounts/select -> 200 OK  (duration: 467.6 ms, execution: 269.1 ms)
Traceback (most recent call last):
  File "/pkg/modal/_runtime/container_io_manager.py", line 946, in handle_input_exception
    yield
  File "/pkg/modal/_container_entrypoint.py", line 126, in run_input_async
    async for value in gen:
  File "/pkg/modal/_runtime/container_io_manager.py", line 276, in call_generator_async
    async for result in gen:
  File "/pkg/modal/_runtime/asgi.py", line 227, in fn
    app_task.result()  # consume/raise exceptions if there are any!
  File "/usr/local/lib/python3.9/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.9/site-packages/fastapi/routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
  File "/root/app/api/v1/endpoints/qbo.py", line 168, in update_account_selection
    await service.sync_transactions() # Will only pick active ones
AttributeError: 'TransactionService' object has no attribute 'sync_transactions'

   POST /api/v1/qbo/accounts/select -> 500 Internal Server Error  (duration: 740.2 ms, execution: 668.7 ms)
ðŸ” [get_accounts] Starting for realm_id: 9341456245321396
    GET /api/v1/accounts/categories -> 200 OK  (duration: 324.3 ms, execution: 245.4 ms)
âœ… [get_accounts] Connection found for user: user_38gfoio189CGrr2AO1a9ssier7w
ðŸ”„ [get_accounts] Starting sync_bank_accounts...
    GET /api/v1/accounts/tags -> 200 OK  (duration: 650.9 ms, execution: 244.1 ms)
ðŸ”„ [SyncService] Syncing bank accounts...
    GET /api/v1/accounts/vendors -> 200 OK  (duration: 955.3 ms, execution: 212.2 ms)
    GET /api/v1/users/me -> 200 OK  (duration: 1.16 s, execution: 308.5 ms)
    GET /api/v1/users/user_38gfoio189CGrr2AO1a9ssier7w -> 200 OK  (duration: 1.44 s, execution: 235.1 ms)
âœ… [get_accounts] sync_bank_accounts completed
ðŸ“Š [get_accounts] Found 4 accounts in database
    GET /api/v1/users/me -> 200 OK  (duration: 648.3 ms, execution: 235.0 ms)
    GET /api/v1/qbo/accounts -> 200 OK  (duration: 2.08 s, execution: 1.99 s)
    GET /api/v1/transactions/ -> 200 OK  (duration: 377.6 ms, execution: 282.5 ms)
ðŸš€ [Modal] ASGI Entrypoint waking up...
ðŸš€ [Modal] ASGI Entrypoint waking up...
ðŸš€ [Modal] ASGI Entrypoint waking up...
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
ðŸ” [get_accounts] Starting for realm_id: 9341456245321396
ðŸ—ï¸ [main.py] Running manual schema patches...
ðŸ—ï¸ [main.py] Running manual schema patches...
âœ… [get_accounts] Connection found for user: user_38gfoio189CGrr2AO1a9ssier7w
ðŸ—ï¸ [main.py] Running manual schema patches...
ðŸ”„ [get_accounts] Starting sync_bank_accounts...
ðŸ”„ [SyncService] Syncing bank accounts...
âŒ [main.py] Database error during startup: (psycopg2.errors.DeadlockDetected) deadlock detected
DETAIL:  Process 4336 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 532.
Process 532 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 4336.
HINT:  See server log for query details.

[SQL: ALTER TABLE qbo_connections ADD COLUMN IF NOT EXISTS updated_at TIMESTAMP WITH TIME ZONE DEFAULT now();]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.DeadlockDetected: deadlock detected
DETAIL:  Process 4336 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 532.
Process 532 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 4336.
HINT:  See server log for query details.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/app/main.py", line 47, in lifespan
    conn.execute(text("ALTER TABLE qbo_connections ADD COLUMN IF NOT EXISTS updated_at TIMESTAMP WITH TIME ZONE DEFAULT now();"))
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.errors.DeadlockDetected) deadlock detected
DETAIL:  Process 4336 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 532.
Process 532 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 4336.
HINT:  See server log for query details.

[SQL: ALTER TABLE qbo_connections ADD COLUMN IF NOT EXISTS updated_at TIMESTAMP WITH TIME ZONE DEFAULT now();]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

âŒ [SyncService] Bank account sync failed: (psycopg2.errors.DeadlockDetected) deadlock detected
LINE 1: UPDATE bank_accounts SET is_connected=false, updated_at=now(...
               ^
DETAIL:  Process 532 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 4215.
Process 4215 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 532.
HINT:  See server log for query details.

[SQL: UPDATE bank_accounts SET is_connected=%(is_connected)s, updated_at=now() WHERE bank_accounts.realm_id = %(realm_id_1)s]
[parameters: {'is_connected': False, 'realm_id_1': '9341456245321396'}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
âš ï¸ [get_accounts] Sync failed: (psycopg2.errors.DeadlockDetected) deadlock detected
LINE 1: UPDATE bank_accounts SET is_connected=false, updated_at=now(...
               ^
DETAIL:  Process 532 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 4215.
Process 4215 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 532.
HINT:  See server log for query details.

[SQL: UPDATE bank_accounts SET is_connected=%(is_connected)s, updated_at=now() WHERE bank_accounts.realm_id = %(realm_id_1)s]
[parameters: {'is_connected': False, 'realm_id_1': '9341456245321396'}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
âœ… [main.py] Schema repair complete.
ðŸ“‹ [get_accounts] Traceback: Traceback (most recent call last):
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.DeadlockDetected: deadlock detected
LINE 1: UPDATE bank_accounts SET is_connected=false, updated_at=now(...
               ^
DETAIL:  Process 532 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 4215.
Process 4215 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 532.
HINT:  See server log for query details.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/app/api/v1/endpoints/qbo.py", line 91, in get_accounts
    await service.sync_bank_accounts() # This syncs all without limit
  File "/root/app/services/transaction_service.py", line 19, in sync_bank_accounts
    await syncer.sync_bank_accounts()
  File "/root/app/services/sync_service.py", line 43, in sync_bank_accounts
    self.db.query(BankAccount).filter(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/orm/query.py", line 3304, in update
    self.session.execute(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/orm/bulk_persistence.py", line 1660, in orm_execute_statement
    return super().orm_execute_statement(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.errors.DeadlockDetected) deadlock detected
LINE 1: UPDATE bank_accounts SET is_connected=false, updated_at=now(...
               ^
DETAIL:  Process 532 waits for RowExclusiveLock on relation 57344 of database 16391; blocked by process 4215.
Process 4215 waits for AccessExclusiveLock on relation 40970 of database 16391; blocked by process 532.
HINT:  See server log for query details.

[SQL: UPDATE bank_accounts SET is_connected=%(is_connected)s, updated_at=now() WHERE bank_accounts.realm_id = %(realm_id_1)s]
[parameters: {'is_connected': False, 'realm_id_1': '9341456245321396'}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

âœ… [main.py] Database initialized.
âœ… [main.py] Schema repair complete.
ðŸ“Š [get_accounts] Found 4 accounts in database
âœ… [main.py] Database initialized.
    GET /api/v1/qbo/accounts -> 200 OK  (duration: 2.86 s, execution: 2.78 s)
âŒ [QBOClient] HTTP Error: {"Fault":{"Error":[{"Message":"Invalid query","Detail":"QueryValidationError: invalid context declaration: CreditCardCredit","code":"4001"}],"type":"ValidationFault"},"time":"2026-02-04T18:52:08.094-08:00"}
   POST /api/v1/qbo/accounts/preview -> 200 OK  (duration: 3.02 s, execution: 2.80 s)
   POST /api/v1/qbo/accounts/select -> 200 OK  (duration: 725.8 ms, execution: 609.5 ms)
    GET /api/v1/accounts/vendors -> 200 OK  (duration: 313.2 ms, execution: 229.3 ms)
    GET /api/v1/accounts/tags -> 200 OK  (duration: 332.4 ms, execution: 242.1 ms)
    GET /api/v1/accounts/categories -> 200 OK  (duration: 592.3 ms, execution: 228.6 ms)
ðŸ” [get_accounts] Starting for realm_id: 9341456245321396
âœ… [get_accounts] Connection found for user: user_38gfoio189CGrr2AO1a9ssier7w
    GET /api/v1/users/user_38gfoio189CGrr2AO1a9ssier7w -> 200 OK  (duration: 584.7 ms, execution: 204.9 ms)
ðŸ”„ [get_accounts] Starting sync_bank_accounts...
    GET /api/v1/users/me -> 200 OK  (duration: 832.6 ms, execution: 204.8 ms)
ðŸ”„ [SyncService] Syncing bank accounts...
    GET /api/v1/users/me -> 200 OK  (duration: 310.3 ms, execution: 207.6 ms)
âœ… [get_accounts] sync_bank_accounts completed
ðŸ“Š [get_accounts] Found 4 accounts in database
    GET /api/v1/qbo/accounts -> 200 OK  (duration: 2.53 s, execution: 2.12 s)
    GET /api/v1/transactions/ -> 200 OK  (duration: 291.4 ms, execution: 197.6 ms)
ðŸš€ [Modal] ASGI Entrypoint waking up...
ðŸš€ [Modal] ASGI Entrypoint waking up...
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
ðŸ—ï¸ [main.py] Running manual schema patches...
ðŸ—ï¸ [main.py] Running manual schema patches...
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
OPTIONS /api/v1/analytics/track -> 200 OK  (duration: 157.1 ms, execution: 62.8 ms)
   POST /api/v1/transactions/sync -> 200 OK  (duration: 448.2 ms, execution: 377.3 ms)
   POST /api/v1/analytics/track -> 200 OK  (duration: 525.0 ms, execution: 420.2 ms)
ðŸ” [get_accounts] Starting for realm_id: 9341456245321396
ðŸ”„ [Modal] Starting background sync for 9341456245321396
âœ… [get_accounts] Connection found for user: user_38gfoio189CGrr2AO1a9ssier7w
    GET /api/v1/transactions/ -> 200 OK  (duration: 344.6 ms, execution: 253.7 ms)
ðŸ”„ [get_accounts] Starting sync_bank_accounts...
ðŸ”„ [SyncService] Syncing bank accounts...
ðŸš€ [SyncService] Starting sync for realm: 9341456245321396
ðŸ”„ [SyncService] Syncing bank accounts...
âœ… [get_accounts] sync_bank_accounts completed
ðŸ“Š [get_accounts] Found 4 accounts in database
    GET /api/v1/qbo/accounts -> 200 OK  (duration: 2.43 s, execution: 2.33 s)
    GET /api/v1/transactions/ -> 200 OK  (duration: 298.4 ms, execution: 224.8 ms)
âŒ [QBOClient] HTTP Error: {"Fault":{"Error":[{"Message":"Invalid query","Detail":"QueryValidationError: invalid context declaration: CreditCardCredit","code":"4001"}],"type":"ValidationFault"},"time":"2026-02-04T18:53:09.569-08:00"}
âš ï¸ Error syncing CreditCardCredit: Client error '400 Bad Request' for url 'https://sandbox-quickbooks.api.intuit.com/v3/company/9341456245321396/query?query=SELECT+%2A+FROM+CreditCardCredit+STARTPOSITION+1+MAXRESULTS+1000'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
âœ… [SyncService] Completed sync for realm: 9341456245321396
âœ… Sync complete
ðŸ§  Triggering AI Analysis...
ðŸ§  [Modal] Starting AI Analysis for 9341456245321396
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸ” [AnalysisService] Starting analysis for realm 9341456245321396...
âœ… Analysis complete. Processed 0 transactions.
ðŸš€ [Modal] ASGI Entrypoint waking up...
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
ðŸ—ï¸ [main.py] Running manual schema patches...
    GET /health -> 200 OK  (duration: 124.9 ms, execution: 38.9 ms)
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
    GET /api/v1/accounts/categories -> 200 OK  (duration: 348.7 ms, execution: 273.1 ms)
ðŸ” [get_accounts] Starting for realm_id: 9341456245321396
âœ… [get_accounts] Connection found for user: user_38gfoio189CGrr2AO1a9ssier7w
ðŸ”„ [get_accounts] Starting sync_bank_accounts...
ðŸ”„ [SyncService] Syncing bank accounts...
âœ… [get_accounts] sync_bank_accounts completed
ðŸ“Š [get_accounts] Found 4 accounts in database
    GET /api/v1/qbo/accounts -> 200 OK  (duration: 2.66 s, execution: 2.26 s)
ðŸš€ [Modal] ASGI Entrypoint waking up...
    GET /api/v1/accounts/tags -> 200 OK  (duration: 2.93 s, execution: 212.5 ms)
ðŸš€ [Modal] ASGI Entrypoint waking up...
    GET /api/v1/accounts/vendors -> 200 OK  (duration: 3.23 s, execution: 249.1 ms)
ðŸš€ [Modal] ASGI Entrypoint waking up...
    GET /api/v1/users/user_38gfoio189CGrr2AO1a9ssier7w -> 200 OK  (duration: 3.25 s, execution: 210.5 ms)
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
    GET /api/v1/users/me -> 200 OK  (duration: 3.54 s, execution: 230.8 ms)
ðŸš€ [Modal] ASGI Entrypoint waking up...
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
    GET /api/v1/transactions/ -> 200 OK  (duration: 2.23 s, execution: 1.06 s)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
    GET /api/v1/users/me -> 200 OK  (duration: 1.40 s, execution: 209.1 ms)
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
ðŸ—ï¸ [main.py] Running manual schema patches...
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
ðŸ—ï¸ [main.py] Running manual schema patches...
ðŸ—ï¸ [main.py] Running manual schema patches...
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
ðŸ—ï¸ [main.py] Running manual schema patches...
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
    GET /api/v1/accounts/tags -> 200 OK  (duration: 889.3 ms, execution: 817.5 ms)
    GET /api/v1/users/me -> 200 OK  (duration: 1.17 s, execution: 233.5 ms)
    GET /api/v1/accounts/vendors -> 200 OK  (duration: 1.50 s, execution: 268.7 ms)
ðŸ” [get_accounts] Starting for realm_id: 9341456245321396
âœ… [get_accounts] Connection found for user: user_38gfoio189CGrr2AO1a9ssier7w
ðŸ”„ [get_accounts] Starting sync_bank_accounts...
ðŸ”„ [SyncService] Syncing bank accounts...
ðŸš€ [Modal] ASGI Entrypoint waking up...
ðŸš€ [Modal] ASGI Entrypoint waking up...
ðŸš€ [Modal] ASGI Entrypoint waking up...
ðŸš€ [Modal] ASGI Entrypoint waking up...
âœ… [get_accounts] sync_bank_accounts completed
ðŸš€ [Modal] ASGI Entrypoint waking up...
ðŸ“Š [get_accounts] Found 4 accounts in database
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
    GET /api/v1/qbo/accounts -> 200 OK  (duration: 4.06 s, execution: 2.50 s)
    GET /api/v1/accounts/categories -> 200 OK  (duration: 4.33 s, execution: 244.4 ms)
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
    GET /api/v1/users/user_38gfoio189CGrr2AO1a9ssier7w -> 200 OK  (duration: 4.69 s, execution: 298.0 ms)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
    GET /api/v1/users/me -> 200 OK  (duration: 3.77 s, execution: 208.0 ms)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸ—ï¸ [main.py] Running manual schema patches...
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
ðŸ—ï¸ [main.py] Running manual schema patches...
    GET /api/v1/transactions/ -> 200 OK  (duration: 2.07 s, execution: 1.12 s)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
âœ… [main.py] Schema repair complete.
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
âœ… [main.py] Database initialized.
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
ðŸ—ï¸ [main.py] Running manual schema patches...
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
ðŸ—ï¸ [main.py] Running manual schema patches...
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
ðŸ—ï¸ [main.py] Running manual schema patches...
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
ðŸš€ [Modal] ASGI Entrypoint waking up...
/usr/local/lib/python3.9/site-packages/google/api_core/_python_version_support.py:246: FutureWarning: You are using a non-supported Python version (3.9.22). Google will not post any further updates to google.api_core supporting this Python version. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
  warnings.warn(message, FutureWarning)
/usr/local/lib/python3.9/site-packages/google/auth/__init__.py:54: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/usr/local/lib/python3.9/site-packages/google/oauth2/__init__.py:40: FutureWarning: You are using a Python version 3.9 past its end of life. Google will update google-auth with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade your Python version, and then update google-auth.
  warnings.warn(eol_message.format("3.9"), FutureWarning)
/root/app/services/ai_analyzer.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ðŸš€ [main.py] initialize_app_logic called (Compatibility Mode)
âœ… [Modal] Ready to serve production traffic.
>>> [main.py] Initializing and Repairing Models...
ðŸ—ï¸ [main.py] Running manual schema patches...
âœ… [main.py] Schema repair complete.
âœ… [main.py] Database initialized.
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
WARNING: Logs may not be continuous
